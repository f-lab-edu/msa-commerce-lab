openapi: 3.0.3
info:
  title: MSA Commerce Lab - Monolith API
  description: |
    MSA Commerce Lab 프로젝트의 모놀리식 서비스 API 명세서입니다.
    헥사고날 아키텍처를 기반으로 구현되었습니다.
  version: 1.0.0
  contact:
    name: MSA Commerce Lab Team
    email: dev@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: 로컬 개발 서버
  - url: https://api-dev.example.com
    description: 개발 환경
  - url: https://api.example.com
    description: 프로덕션 환경

tags:
  - name: Product
    description: 상품 관리 API
    externalDocs:
      description: 상품 API 가이드
      url: https://docs.example.com/product-api

paths:
  /api/v1/products:
    post:
      tags:
        - Product
      summary: 상품 생성
      description: |
        새로운 상품을 생성합니다.
        
        ### 비즈니스 규칙
        - SKU는 중복될 수 없습니다 (자동 생성)
        - 가격은 0.01원 이상 99,999,999.99원 이하여야 합니다
        - 초기 재고 수량은 0 이상이어야 합니다
        - 카테고리 ID는 정의된 값 중 하나여야 합니다 (1-10)
        
        ### 아키텍처
        이 API는 헥사고날 아키텍처의 인바운드 어댑터를 통해 구현되었습니다.
      operationId: createProduct
      requestBody:
        description: 생성할 상품 정보
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreateRequest'
            examples:
              electronics:
                summary: 전자제품 예시
                description: MacBook Pro 상품 생성 예시
                value:
                  sku: "MACB-16-M3MAX"
                  name: "MacBook Pro 16"
                  description: "Apple MacBook Pro 16인치 M3 Max"
                  shortDescription: "고성능 16인치 맥북 프로"
                  brand: "Apple"
                  model: "MacBook Pro M3 Max"
                  price: 3490000
                  comparePrice: 3790000
                  categoryId: 1
                  initialStock: 50
                  minOrderQuantity: 1
                  maxOrderQuantity: 5
                  reorderPoint: 5
                  reorderQuantity: 20
                  locationCode: "MAIN"
                  visibility: "PUBLIC"
                  isFeatured: true
                  metaTitle: "MacBook Pro 16인치 M3 Max"
                  metaDescription: "Apple 최신 MacBook Pro 16인치 모델"
                  searchKeywords: "맥북,프로,애플,노트북"
              clothing:
                summary: 의류 예시
                description: 티셔츠 상품 생성 예시
                value:
                  sku: "BW-001-BASIC"
                  name: "Basic Cotton T-Shirt"
                  description: "100% 면소재 베이직 티셔츠"
                  shortDescription: "편안한 베이직 티셔츠"
                  brand: "BasicWear"
                  model: "BW-001"
                  price: 29900
                  categoryId: 2
                  initialStock: 100
                  minOrderQuantity: 1
                  maxOrderQuantity: 50
                  reorderPoint: 10
                  reorderQuantity: 50
                  locationCode: "MAIN"
                  visibility: "PUBLIC"
                  isFeatured: false
      responses:
        '201':
          description: 상품 생성 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
              examples:
                success:
                  summary: 성공 응답 예시
                  value:
                    id: 1
                    categoryId: 1
                    sku: "MACB-12AB34CD"
                    name: "MacBook Pro 16"
                    description: "Apple MacBook Pro 16인치 M3 Max"
                    shortDescription: "고성능 16인치 맥북 프로"
                    brand: "Apple"
                    model: "MacBook Pro M3 Max"
                    price: 3490000
                    comparePrice: 3790000
                    status: "DRAFT"
                    visibility: "PUBLIC"
                    isFeatured: true
                    availableQuantity: 50
                    reservedQuantity: 0
                    totalQuantity: 50
                    lowStockThreshold: 5
                    isTrackingEnabled: true
                    isBackorderAllowed: false
                    minOrderQuantity: 1
                    maxOrderQuantity: 5
                    reorderPoint: 5
                    reorderQuantity: 20
                    locationCode: "MAIN"
                    versionNumber: 0
                    metaTitle: "MacBook Pro 16인치 M3 Max"
                    metaDescription: "Apple 최신 MacBook Pro 16인치 모델"
                    searchKeywords: "맥북,프로,애플,노트북"
                    createdAt: "2024-01-15T10:30:00"
                    updatedAt: "2024-01-15T10:30:00"
        '400':
          description: 잘못된 요청 데이터
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                validation_error:
                  summary: 유효성 검증 실패
                  value:
                    message: "Validation failed for 1 field(s)"
                    timestamp: "2024-01-15T10:30:00"
                    path: "/api/v1/products"
                    status: 400
                    validationErrors:
                      - field: "name"
                        rejectedValue: ""
                        message: "Product name is required."
                invalid_price:
                  summary: 가격 범위 오류
                  value:
                    message: "Price must be greater than 0."
                    timestamp: "2024-01-15T10:30:00"
                    path: "/api/v1/products"
                    status: 400
        '409':
          description: 중복된 SKU
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicate_sku:
                  summary: 중복된 SKU
                  value:
                    message: "Product SKU already exists: MACB-12AB34CD"
                    code: "PRODUCT_SKU_DUPLICATE"
                    timestamp: "2024-01-15T10:30:00"
                    path: "/api/v1/products"
                    status: 409
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                internal_error:
                  summary: 서버 내부 오류
                  value:
                    message: "서버 내부 오류가 발생했습니다."
                    timestamp: "2024-01-15T10:30:00"
                    path: "/api/v1/products"
                    status: 500

  /api/v1/products/{id}:
    put:
      tags:
        - Product
      summary: 상품 수정
      description: |
        기존 상품의 정보를 수정합니다.
        
        ### 비즈니스 규칙
        - 부분 업데이트를 지원합니다 (변경할 필드만 포함)
        - 가격은 0.01원 이상 99,999,999.99원 이하여야 합니다
        - SKU는 수정할 수 없습니다
        - 빈 값("")과 null 값을 구분하여 처리합니다
        - 변경 내역은 이력으로 관리됩니다
        
        ### 아키텍처
        이 API는 헥사고날 아키텍처의 인바운드 어댑터를 통해 구현되었습니다.
        도메인 기반 예외 처리와 글로벌 예외 핸들러를 통한 적절한 HTTP 상태 코드를 제공합니다.
      operationId: updateProduct
      parameters:
        - name: id
          in: path
          description: 수정할 상품의 ID
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
          example: 1
      requestBody:
        description: 수정할 상품 정보 (부분 업데이트 지원)
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUpdateRequest'
            examples:
              partial_update:
                summary: 부분 업데이트 예시
                description: 이름과 가격만 변경
                value:
                  name: "MacBook Pro 16 (2024)"
                  price: 3590000
              full_update:
                summary: 전체 업데이트 예시
                description: 모든 필드 변경
                value:
                  name: "MacBook Pro 16 (2024 Updated)"
                  description: "최신 M3 Max 칩셋을 탑재한 MacBook Pro 16인치 2024년형"
                  shortDescription: "2024년형 16인치 맥북 프로"
                  brand: "Apple"
                  model: "MacBook Pro M3 Max 2024"
                  price: 3590000
                  comparePrice: 3890000
                  weight: 2.16
                  visibility: "PUBLIC"
                  isFeatured: true
                  metaTitle: "MacBook Pro 16인치 2024년형"
                  metaDescription: "Apple 최신 MacBook Pro 16인치 2024년형 모델"
                  searchKeywords: "맥북,프로,애플,노트북,2024"
              price_only:
                summary: 가격만 변경
                description: 가격 업데이트 예시
                value:
                  price: 3290000
      responses:
        '200':
          description: 상품 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
              examples:
                success:
                  summary: 성공 응답 예시
                  value:
                    id: 1
                    categoryId: 1
                    sku: "MACB-12AB34CD"
                    name: "MacBook Pro 16 (2024)"
                    description: "최신 M3 Max 칩셋을 탑재한 MacBook Pro 16인치 2024년형"
                    shortDescription: "2024년형 16인치 맥북 프로"
                    brand: "Apple"
                    model: "MacBook Pro M3 Max 2024"
                    price: 3590000
                    comparePrice: 3890000
                    status: "ACTIVE"
                    visibility: "PUBLIC"
                    isFeatured: true
                    availableQuantity: 45
                    reservedQuantity: 5
                    totalQuantity: 50
                    versionNumber: 2
                    createdAt: "2024-01-15T10:30:00"
                    updatedAt: "2024-01-15T14:20:00"
        '400':
          description: 잘못된 요청 데이터
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                validation_error:
                  summary: 유효성 검증 실패
                  value:
                    message: "Validation failed for 1 field(s)"
                    timestamp: "2024-01-15T14:20:00"
                    path: "/api/v1/products/1"
                    status: 400
                    validationErrors:
                      - field: "price"
                        rejectedValue: "-100"
                        message: "Price must be greater than 0."
                no_changes:
                  summary: 변경사항 없음
                  value:
                    message: "No fields to update provided."
                    timestamp: "2024-01-15T14:20:00"
                    path: "/api/v1/products/1"
                    status: 400
                invalid_price:
                  summary: 가격 범위 오류
                  value:
                    message: "Price must be greater than 0."
                    timestamp: "2024-01-15T14:20:00"
                    path: "/api/v1/products/1"
                    status: 400
        '403':
          description: 업데이트 권한 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                update_not_allowed:
                  summary: 업데이트 권한 없음
                  value:
                    message: "Product update not allowed in current status"
                    code: "PRODUCT_UPDATE_NOT_ALLOWED"
                    timestamp: "2024-01-15T14:20:00"
                    path: "/api/v1/products/1"
                    status: 403
        '404':
          description: 상품을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                product_not_found:
                  summary: 상품 없음
                  value:
                    message: "Product not found with ID: 999"
                    code: "PRODUCT_NOT_FOUND"
                    timestamp: "2024-01-15T14:20:00"
                    path: "/api/v1/products/999"
                    status: 404
        '409':
          description: 중복된 데이터 또는 동시 수정 충돌
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                duplicate_name:
                  summary: 중복된 상품명
                  value:
                    message: "Product name already exists: MacBook Pro 16"
                    code: "PRODUCT_NAME_DUPLICATE"
                    timestamp: "2024-01-15T14:20:00"
                    path: "/api/v1/products/1"
                    status: 409
                version_conflict:
                  summary: 버전 충돌 (낙관적 잠금)
                  value:
                    message: "Product has been modified by another user"
                    code: "PRODUCT_VERSION_CONFLICT"
                    timestamp: "2024-01-15T14:20:00"
                    path: "/api/v1/products/1"
                    status: 409
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                internal_error:
                  summary: 서버 내부 오류
                  value:
                    message: "서버 내부 오류가 발생했습니다."
                    timestamp: "2024-01-15T14:20:00"
                    path: "/api/v1/products/1"
                    status: 500

components:
  schemas:
    ProductCreateRequest:
      type: object
      required:
        - name
        - price
        - categoryId
        - sku
      properties:
        categoryId:
          type: integer
          format: int64
          minimum: 1
          maximum: 10
          description: 카테고리 ID (1-10)
          example: 1
        sku:
          type: string
          maxLength: 100
          description: 상품 SKU (Stock Keeping Unit)
          example: "MACB-12AB34CD"
        name:
          type: string
          maxLength: 255
          description: 상품명
          example: "MacBook Pro 16"
        description:
          type: string
          maxLength: 5000
          description: 상품 설명
          example: "Apple MacBook Pro 16인치 M3 Max"
        shortDescription:
          type: string
          maxLength: 500
          description: 짧은 설명
          example: "고성능 16인치 맥북 프로"
        brand:
          type: string
          maxLength: 100
          description: 브랜드명
          example: "Apple"
        model:
          type: string
          maxLength: 100
          description: 모델명
          example: "MacBook Pro M3 Max"
        price:
          type: number
          format: decimal
          minimum: 0.01
          maximum: 99999999.99
          description: 가격 (원)
          example: 3490000
        comparePrice:
          type: number
          format: decimal
          minimum: 0.01
          description: 비교가격 (할인 전 원가)
          example: 3790000
        costPrice:
          type: number
          format: decimal
          minimum: 0.01
          description: 원가
          example: 2500000
        weight:
          type: number
          format: decimal
          minimum: 0.01
          description: 무게 (kg)
          example: 2.14
        productAttributes:
          type: string
          description: 상품 속성 (JSON 형태)
          example: '{"color": "Space Gray", "storage": "1TB"}'
        visibility:
          type: string
          maxLength: 20
          description: 공개 상태
          enum: ["PUBLIC", "PRIVATE", "HIDDEN"]
          default: "PUBLIC"
          example: "PUBLIC"
        taxClass:
          type: string
          maxLength: 50
          description: 세금 분류
          example: "STANDARD"
        metaTitle:
          type: string
          maxLength: 255
          description: SEO 제목
          example: "MacBook Pro 16인치 M3 Max"
        metaDescription:
          type: string
          maxLength: 500
          description: SEO 설명
          example: "Apple 최신 MacBook Pro 16인치 모델"
        searchKeywords:
          type: string
          maxLength: 1000
          description: 검색 키워드
          example: "맥북,프로,애플,노트북"
        isFeatured:
          type: boolean
          description: 추천 상품 여부
          default: false
          example: true
        initialStock:
          type: integer
          minimum: 0
          description: 초기 재고 수량
          example: 50
        lowStockThreshold:
          type: integer
          minimum: 0
          description: 재고 부족 임계값
          example: 5
        isTrackingEnabled:
          type: boolean
          description: 재고 추적 여부
          default: true
          example: true
        isBackorderAllowed:
          type: boolean
          description: 품절 시 주문 허용 여부
          default: false
          example: false
        minOrderQuantity:
          type: integer
          minimum: 1
          description: 최소 주문 수량
          default: 1
          example: 1
        maxOrderQuantity:
          type: integer
          minimum: 1
          description: 최대 주문 수량 (null이면 제한 없음)
          example: 100
        reorderPoint:
          type: integer
          minimum: 0
          description: 재주문 임계점
          default: 0
          example: 20
        reorderQuantity:
          type: integer
          minimum: 0
          description: 재주문 수량
          default: 0
          example: 100
        locationCode:
          type: string
          maxLength: 50
          description: 창고/위치 코드
          default: "MAIN"
          example: "MAIN"

    ProductUpdateRequest:
      type: object
      description: |
        상품 수정 요청 스키마 (부분 업데이트 지원)
        - 모든 필드는 선택사항입니다
        - 빈 값("")과 null 값을 구분하여 처리합니다
        - 제공된 필드만 업데이트됩니다
        - SKU는 수정할 수 없습니다 (포함되어도 무시됨)
      properties:
        name:
          type: string
          maxLength: 255
          description: 상품명
          example: "MacBook Pro 16 (2024)"
        description:
          type: string
          maxLength: 5000
          description: 상품 설명
          example: "최신 M3 Max 칩셋을 탑재한 MacBook Pro 16인치 2024년형"
        shortDescription:
          type: string
          maxLength: 500
          description: 짧은 설명
          example: "2024년형 16인치 맥북 프로"
        brand:
          type: string
          maxLength: 100
          description: 브랜드명
          example: "Apple"
        model:
          type: string
          maxLength: 100
          description: 모델명
          example: "MacBook Pro M3 Max 2024"
        price:
          type: number
          format: decimal
          minimum: 0.01
          maximum: 99999999.99
          description: 가격 (원)
          example: 3590000
        comparePrice:
          type: number
          format: decimal
          minimum: 0.01
          description: 비교가격 (할인 전 원가)
          example: 3890000
        costPrice:
          type: number
          format: decimal
          minimum: 0.01
          description: 원가
          example: 2600000
        weight:
          type: number
          format: decimal
          minimum: 0.01
          description: 무게 (kg)
          example: 2.16
        productAttributes:
          type: string
          description: 상품 속성 (JSON 형태)
          example: '{"color": "Space Gray", "storage": "1TB", "memory": "32GB"}'
        visibility:
          type: string
          maxLength: 20
          description: 공개 상태
          enum: ["PUBLIC", "PRIVATE", "HIDDEN"]
          example: "PUBLIC"
        taxClass:
          type: string
          maxLength: 50
          description: 세금 분류
          example: "STANDARD"
        metaTitle:
          type: string
          maxLength: 255
          description: SEO 제목
          example: "MacBook Pro 16인치 2024년형"
        metaDescription:
          type: string
          maxLength: 500
          description: SEO 설명
          example: "Apple 최신 MacBook Pro 16인치 2024년형 모델"
        searchKeywords:
          type: string
          maxLength: 1000
          description: 검색 키워드
          example: "맥북,프로,애플,노트북,2024"
        isFeatured:
          type: boolean
          description: 추천 상품 여부
          example: true
        # 재고 관련 필드는 별도 API로 관리 (업데이트 API에서는 제외)
        # 상태 변경은 별도 API로 관리 (업데이트 API에서는 제외)

    ProductResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 상품 ID
          example: 1
        categoryId:
          type: integer
          format: int64
          description: 카테고리 ID
          example: 1
        sku:
          type: string
          description: 상품 SKU (자동 생성)
          example: "MACB-12AB34CD"
        name:
          type: string
          description: 상품명
          example: "MacBook Pro 16"
        description:
          type: string
          description: 상품 설명
          example: "Apple MacBook Pro 16인치 M3 Max"
        shortDescription:
          type: string
          description: 짧은 설명
          example: "고성능 16인치 맥북 프로"
        brand:
          type: string
          description: 브랜드명
          example: "Apple"
        model:
          type: string
          description: 모델명
          example: "MacBook Pro M3 Max"
        price:
          type: number
          format: decimal
          description: 가격 (원)
          example: 3490000
        comparePrice:
          type: number
          format: decimal
          description: 비교가격 (할인 전 원가)
          example: 3790000
        costPrice:
          type: number
          format: decimal
          description: 원가
          example: 2500000
        weight:
          type: number
          format: decimal
          description: 무게 (kg)
          example: 2.14
        productAttributes:
          type: string
          description: 상품 속성 (JSON 형태)
          example: '{"color": "Space Gray", "storage": "1TB"}'
        status:
          $ref: '#/components/schemas/ProductStatus'
        visibility:
          type: string
          description: 공개 상태
          enum: ["PUBLIC", "PRIVATE", "HIDDEN"]
          example: "PUBLIC"
        taxClass:
          type: string
          description: 세금 분류
          example: "STANDARD"
        metaTitle:
          type: string
          description: SEO 제목
          example: "MacBook Pro 16인치 M3 Max"
        metaDescription:
          type: string
          description: SEO 설명
          example: "Apple 최신 MacBook Pro 16인치 모델"
        searchKeywords:
          type: string
          description: 검색 키워드
          example: "맥북,프로,애플,노트북"
        isFeatured:
          type: boolean
          description: 추천 상품 여부
          example: true
        # 재고 정보
        availableQuantity:
          type: integer
          description: 판매 가능 재고 수량
          example: 90
        reservedQuantity:
          type: integer
          description: 예약된 재고 수량
          example: 10
        totalQuantity:
          type: integer
          description: 전체 재고 수량
          example: 100
        lowStockThreshold:
          type: integer
          description: 재고 부족 임계값
          example: 5
        isTrackingEnabled:
          type: boolean
          description: 재고 추적 여부
          example: true
        isBackorderAllowed:
          type: boolean
          description: 품절 시 주문 허용 여부
          example: false
        # 확장된 재고 관리 필드
        minOrderQuantity:
          type: integer
          description: 최소 주문 수량
          example: 1
        maxOrderQuantity:
          type: integer
          description: 최대 주문 수량
          example: 100
        reorderPoint:
          type: integer
          description: 재주문 임계점
          example: 20
        reorderQuantity:
          type: integer
          description: 재주문 수량
          example: 100
        locationCode:
          type: string
          description: 창고/위치 코드
          example: "MAIN"
        versionNumber:
          type: integer
          format: int64
          description: 낙관적 잠금을 위한 버전 번호
          example: 1
        createdAt:
          type: string
          format: date-time
          description: 생성일시
          example: "2024-01-15T10:30:00"
        updatedAt:
          type: string
          format: date-time
          description: 수정일시
          example: "2024-01-15T10:30:00"

    ProductCategory:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 카테고리 ID
          example: 1
        name:
          type: string
          description: 카테고리 이름
          example: "ELECTRONICS"
        displayName:
          type: string
          description: 카테고리 표시명
          example: "전자제품"
        code:
          type: string
          description: 카테고리 코드
          example: "ELEC"
      description: |
        상품 카테고리 정보
        - ID 1: ELECTRONICS (전자제품)
        - ID 2: CLOTHING (의류)
        - ID 3: BOOKS (도서)
        - ID 4: HOME_GARDEN (홈&가든)
        - ID 5: SPORTS (스포츠)
        - ID 6: BEAUTY (뷰티)
        - ID 7: FOOD (식품)
        - ID 8: TOYS (장난감)
        - ID 9: AUTOMOTIVE (자동차)
        - ID 10: HEALTH (건강)

    ProductStatus:
      type: string
      enum:
        - DRAFT
        - ACTIVE
        - INACTIVE
        - ARCHIVED
      description: |
        상품 상태
        - DRAFT: 초안 상태 (작성 중)
        - ACTIVE: 활성 상태 (판매 가능)
        - INACTIVE: 비활성 상태 (판매 불가)
        - ARCHIVED: 보관된 상태 (더 이상 판매하지 않음)
      example: "DRAFT"

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          description: 오류 메시지
          example: "Product name is required."
        code:
          type: string
          description: 오류 코드 (선택적)
          example: "P1001"
        timestamp:
          type: string
          format: date-time
          description: 오류 발생 시각
          example: "2024-01-15T10:30:00"
        path:
          type: string
          description: 요청 경로
          example: "/api/v1/products"
        status:
          type: integer
          description: HTTP 상태 코드
          example: 400
        validationErrors:
          type: array
          description: 유효성 검증 오류 목록 (선택적)
          items:
            $ref: '#/components/schemas/ValidationError'
        debugInfo:
          type: string
          description: 디버그 정보 (개발 환경에서만)
          example: "IllegalArgumentException"
      required:
        - message
        - timestamp
        - path
        - status

    ValidationError:
      type: object
      properties:
        field:
          type: string
          description: 오류가 발생한 필드명
          example: "name"
        rejectedValue:
          type: string
          description: 거부된 값
          example: ""
        message:
          type: string
          description: 필드별 오류 메시지
          example: "Product name is required."
      required:
        - field
        - message


# 보안 설정 (추후 확장 시)
# security:
#   - bearerAuth: []

# components:
#   securitySchemes:
#     bearerAuth:
#       type: http
#       scheme: bearer
#       bearerFormat: JWT